#!/bin/bash

# clean_cmake: Safely removes files generated by a CMake build

# Ensure script is run in a directory named "build"
CURRENT_DIR=$(basename "$PWD")
if [[ "$CURRENT_DIR" != "build" ]]; then
    echo "Error: This script must be run from a directory named 'build'."
    exit 1
fi

# Check for confirmation
read -p "Are you sure you want to clean the CMake build files in this directory? (y/N) " CONFIRM
if [[ "$CONFIRM" != "y" && "$CONFIRM" != "Y" ]]; then
    echo "Operation cancelled."
    exit 0
fi

# List of common files and directories to remove
TO_REMOVE=(
    "CMakeCache.txt"
    "CMakeFiles"
    "Makefile"
    "*.mod"
    "*genmod.f90"
    "cmake_install.cmake"
    "CTestTestfile.cmake"
    "Testing"
    "install_manifest.txt"
)

# Function to remove items
clean_files() {
    for item in "${TO_REMOVE[@]}"; do
        if [[ "$item" == *"*"* ]]; then
            # Handle wildcard patterns like *.mod with case-insensitive matching
            find . -type f -iname "$item" -exec rm -f {} +
        else
            # Remove files or directories
            rm -rf "$item"
        fi
    done
    echo "CMake build files cleaned."
}

# Execute the cleaning function
clean_files
